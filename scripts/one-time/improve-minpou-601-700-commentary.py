#!/usr/bin/env python3
"""
民法第601-700条のcommentaryOsakaを高品質化するスクリプト
"""

import yaml
import os
from pathlib import Path

# YAMLファイルのパス
BASE_DIR = Path("src/data/laws/jp/minpou")

# 条文ごとの高品質な大阪弁解説
COMMENTARIES = {
    616: [
        "この条文は、借りてる人が亡くなっても賃貸借契約は終わらへんっちゅうルールを決めてるんや。使用貸借（タダで貸し借りする契約）と違って、賃貸借は賃料を払う契約やから、相続人が引き継げるんやねん。",
        "例えばな、Aさんがアパートを借りてて、突然亡くなってしもたとするやろ。Aさんの子どものBさんが相続人やったら、Bさんが賃貸借契約を引き継いで、そのままアパートに住み続けることができるんや。大家さんは「Aさんが亡くなったから出ていけ」って言えへんねん。",
        "これは、賃貸借が財産的な価値を持つ権利やからなんや。賃料を払ってる限り、その権利は相続できるんやねん。特に、住む場所を失わへんようにするために大事な決まりやで。",
        "ただし、相続人は賃料を払う義務も引き継ぐんや。権利だけやなくて、義務も一緒に相続されるっちゅうことやねん。Bさんは、Aさんの代わりに毎月の家賃を払っていかなあかんのや。",
    ],
    617: [
        "この条文は、借りてる人が適切に使わへんかったり、賃料を払わへんかったりした時に、大家さんが契約を解除できるっちゅうルールを決めてるんや。でも、信頼関係が壊れてへんような軽い違反やったら、解除できへんねん。",
        "例えばな、Aさんがアパートを借りてて、6ヶ月も家賃を払ってへんとするやろ。大家さんのBさんは「もう信頼できへん」って思って、契約を解除できるんや。でも、たった1日遅れただけやったら、それだけで解除はできへんねん。ある程度の期間を催告してからやないと、解除できへんのや。",
        "それと、借りてる物を無断で又貸ししたり、ひどく壊したりした場合も、解除理由になるんや。例えば、Aさんが勝手にアパートを改造して、壁を壊してしもたとするやろ。これは用法違反やから、Bさんは契約を解除できるんやねん。",
        "大事なのは「信頼関係が破壊された」っちゅうことやねん。ちょっとした違反やったら、まだ信頼関係は残ってるから解除できへんけど、重大な違反が続いたら、もう信頼できへんやろ？そういう時に解除を認めてるんや。",
    ],
    618: [
        "この条文は、賃貸借契約が終わった時の明渡しについて決めてるんや。借りてる人は、原状回復した上で物を返さなあかんのやけど、通常の使用で生じた損耗や経年劣化は直さんでもええっちゅうことやねん。",
        "例えばな、Aさんがアパートを5年間借りてて、契約が終わって出ていく時のことを考えてみるやろ。壁紙が日焼けで少し色褪せてても、これは通常の使用の範囲やから、Aさんが直す必要はないんや。でも、壁に穴を開けてしもたんやったら、これはAさんが直さなあかんねん。",
        "通常損耗っちゅうのは、普通に生活してたら避けられへん劣化のことやねん。フローリングの小さな傷とか、畳の日焼けとか、こういうのは大家さんが負担するんや。賃料の中に、そういう劣化分も含まれてると考えられてるんやで。",
        "この決まりは、借りてる人を保護するためにあるんや。昔は、敷金から全部差し引かれたりして、トラブルが多かったんやねん。せやから、法律で明確に「通常損耗は借りてる人の負担やない」って決めたんや。",
    ],
    619: [
        "この条文は、賃貸借契約が終わって物を返した後でも、損害賠償の請求ができるっちゅうルールを決めてるんや。返還したから全て終わりやなくて、損害があればちゃんと請求できるんやねん。",
        "例えばな、Aさんが借りてたアパートを返した後で、大家さんのBさんが壁の裏に大きな穴が開いてるのを発見したとするやろ。これはAさんが隠してた損害やから、Bさんは後からでもAさんに修理費を請求できるんや。返還時に気づかへんかったとしても、請求できるんやねん。",
        "それと、借りてた期間中の未払い賃料とかも、返還後に請求できるんやで。例えば、最後の月の賃料を払わんと出ていってしもた場合、後から請求できるっちゅうことやねん。",
        "この決まりは、返還したら全て終わりっちゅうことやなくて、ちゃんと損害を回復できるようにするためにあるんや。急いで返還する時に、細かいチェックができへんこともあるやろ？そういう時のために、後からでも請求できるようにしてるんやで。",
    ],
    620: [
        "この条文は、賃貸借契約に期間の定めがない場合、いつでも解約できるっちゅうルールを決めてるんや。ただし、いきなり「明日出ていけ」っちゅうのはあかんから、解約の申し入れから一定期間経ってから終了するんやねん。",
        "例えばな、Aさんが期間の定めなしでアパートを借りてて、「もう出ていきたい」って思ったとするやろ。大家さんのBさんに「来月末で出ます」って言うたら、3ヶ月後に契約が終了するんや。土地やったら1年後、動産やったら1日後やねん。",
        "逆に、大家さんの方から解約する時も同じルールやで。Bさんが「アパートを取り壊すから出ていってほしい」って言うた場合も、3ヶ月後に契約が終了するんや。すぐに出ていかなあかんわけやないから、次の住まいを探す時間があるんやねん。",
        "この決まりは、期間の定めがない契約でも、ちゃんと予測可能性を持たせるためにあるんや。いつでも解約できるけど、急に出ていかなあかんわけやないから、お互いに準備ができるんやで。",
    ],
}


def load_yaml_safely(filepath):
    """YAMLファイルを安全に読み込む"""
    with open(filepath, "r", encoding="utf-8") as f:
        return yaml.safe_load(f)


def save_yaml_safely(filepath, data):
    """YAMLファイルを安全に保存する（配列形式を保持）"""
    with open(filepath, "w", encoding="utf-8") as f:
        yaml.dump(
            data, f, allow_unicode=True, default_flow_style=False, sort_keys=False
        )


def update_commentary(article_num, commentary_list):
    """指定された条文のcommentaryOsakaを更新"""
    filepath = BASE_DIR / f"{article_num}.yaml"

    if not filepath.exists():
        print(f"⚠️  {article_num}.yaml が見つかりません")
        return False

    try:
        data = load_yaml_safely(filepath)

        # 削除条文はスキップ
        if data.get("isDeleted") == True:
            print(f"⏭️  第{article_num}条: 削除条文のためスキップ")
            return False

        # commentaryOsakaを更新
        data["commentaryOsaka"] = commentary_list

        save_yaml_safely(filepath, data)
        print(f"✅ 第{article_num}条: commentaryOsakaを更新しました")
        return True

    except Exception as e:
        print(f"❌ 第{article_num}条: エラー - {e}")
        return False


def main():
    print("=== 民法第616-620条 commentaryOsaka 更新スクリプト ===\n")

    updated_count = 0

    for article_num, commentary in COMMENTARIES.items():
        if update_commentary(article_num, commentary):
            updated_count += 1

    print(f"\n✅ 完了: {updated_count}条を更新しました")


if __name__ == "__main__":
    main()
